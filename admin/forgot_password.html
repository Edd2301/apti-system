<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forgot Password - APTI Property Management</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../common/css/style.css">
</head>
<body class="admin-theme">
    <div class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <img src="../common/Logo for Apartment Management.png" alt="APTI Password Reset Logo with secure design" class="logo mb-3" onerror="this.style.display='none';" />
                <h1>Reset Password</h1>
                <p>Enter your email address and we'll send you a reset link</p>
            </div>
            
            <div id="message-container"></div>
            
            <form id="forgotPasswordForm">
                <div class="form-group">
                    <label for="email" class="form-label">Email Address</label>
                    <input type="email" id="email" name="email" class="form-input" required placeholder="Enter your email address">
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-bottom: 1rem;">
                    Send Reset Link
                </button>
            </form>
            
            <div class="auth-footer">
                <p>Remember your password? <a href="login.html">Sign in here</a></p>
                <p>Need an account? <a href="signup.html">Create admin account</a></p>
                <p><a href="../index.html">‚Üê Back to Home</a></p>
            </div>
        </div>
    </div>

    <script src="../common/js/util.js"></script>
    <script src="../common/js/auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="../APTI/common/js/firebase-config.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const forgotPasswordForm = document.getElementById('forgotPasswordForm');
            const messageContainer = document.getElementById('message-container');
            
            forgotPasswordForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const submitButton = e.target.querySelector('button[type="submit"]');
                APTI_Utils.showLoading(submitButton, 'Sending...');
                
                try {
                    const formData = new FormData(forgotPasswordForm);
                    const email = formData.get('email');
                    
                    // Validate email
                    if (!email) {
                        throw new Error('Please enter your email address');
                    }
                    
                    if (!APTI_Utils.validateEmail(email)) {
                        throw new Error('Please enter a valid email address');
                    }
                    
                    const result = await APTI_Auth.forgotPassword(email, 'admin');
                    
                    if (result.success) {
                        APTI_Utils.showSuccess(messageContainer, result.message);
                        
                        // Show additional instructions
                        setTimeout(() => {
                            const instructionsDiv = document.createElement('div');
                            instructionsDiv.className = 'alert alert-info';
                            instructionsDiv.innerHTML = `
                                <strong>Next Steps:</strong><br>
                                1. Check your email inbox and spam folder<br>
                                2. Click the reset link in the email<br>
                                3. Follow the instructions to create a new password<br><br>
                                <small>If you don't receive an email within 10 minutes, please contact support.</small>
                            `;
                            messageContainer.appendChild(instructionsDiv);
                        }, 2000);
                        
                        // Disable form
                        forgotPasswordForm.style.opacity = '0.6';
                        forgotPasswordForm.style.pointerEvents = 'none';
                        
                    } else {
                        throw new Error(result.error || 'Failed to send reset link');
                    }
                    
                } catch (error) {
                    console.error('Forgot password error:', error);
                    APTI_Utils.showError(messageContainer, error.message);
                } finally {
                    APTI_Utils.hideLoading(submitButton);
                }
            });
            
            // Email validation on blur
            document.getElementById('email').addEventListener('blur', function() {
                if (this.value && !APTI_Utils.validateEmail(this.value)) {
                    this.style.borderColor = 'var(--danger-color)';
                    APTI_Utils.showError(messageContainer, 'Please enter a valid email address');
                } else {
                    this.style.borderColor = '';
                    APTI_Utils.clearMessages(messageContainer);
                }
            });
        });
    </script>
</body>
</html>