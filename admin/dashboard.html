<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - APTI Property Management</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../common/css/style.css">
</head>
<body class="admin-theme">
    <!-- Top Navigation Bar -->
    <nav class="top-navbar">
        <div class="top-nav-content">
            <div class="top-nav-right">
                <span class="welcome-text">Welcome Matthew Mallen</span>
                <button onclick="APTI_Auth.logout('admin')" class="btn btn-danger logout-btn">Logout</button>
            </div>
        </div>
    </nav>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-content">
                <a href="dashboard.html" class="nav-brand">APTI Admin</a>
                <ul class="nav-menu">
                    <li class="nav-item"><a href="dashboard.html">Dashboard</a></li>
                    <li class="nav-item"><a href="units.html">Units</a></li>
                    <li class="nav-item"><a href="tenants.html">Tenants</a></li>
                    <li class="nav-item"><a href="bills.html">Bills</a></li>
                    <li class="nav-item"><a href="payment.html">Payments</a></li>
                    <li class="nav-item"><a href="maintenance.html">Maintenance</a></li>
                    <li class="nav-item"><a href="announcements.html">Announcements</a></li>
                    <li class="nav-item"><a href="document_lease.html">Document Lease</a></li>
                    <li class="nav-item"><a href="sms_email.html" class="active">Communications</a></li>
                </ul>

            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container" style="padding: 2rem 1rem;">
        <div class="mb-4">
            <h1>Dashboard Overview</h1>
            <p>Welcome to your property management dashboard</p>
        </div>

        <!-- Statistics Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalUnits">0</div>
                <div class="stat-label">Total Units</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalTenants">0</div>
                <div class="stat-label">Active Tenants</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="unpaidBills">0</div>
                <div class="stat-label">Unpaid Bills</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="maintenanceRequests">0</div>
                <div class="stat-label">Maintenance Requests</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalMessages">0</div>
                <div class="stat-label">Total Messages</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="messageSuccessRate">0%</div>
                <div class="stat-label">Message Success Rate</div>
            </div>
        </div>

        <!-- Charts and Recent Activity -->
        <div class="grid grid-2">
            <!-- Revenue Chart -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Monthly Revenue</h3>
                </div>
                <div id="revenueChart" style="height: 300px; display: flex; align-items: center; justify-content: center; background: linear-gradient(45deg, #4f46e5, #10b981); border-radius: 0.5rem; color: white;">
                    <div style="text-align: center;">
                        <div style="font-size: 2rem; font-weight: bold;">$45,280</div>
                        <div>This Month</div>
                        <div style="margin-top: 1rem; font-size: 0.875rem; opacity: 0.8;">
                            â†— 12% increase from last month
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Recent Activity</h3>
                </div>
                <div id="recentActivity">
                    <div style="padding: 0.5rem 0; border-bottom: 1px solid #4a4a5e;">
                        <div style="font-weight: 500;">New tenant registered</div>
                        <div style="font-size: 0.875rem; color: var(--admin-text-secondary);">John Doe - Unit A101</div>
                        <div style="font-size: 0.75rem; color: var(--admin-text-secondary);">2 hours ago</div>
                    </div>
                    <div style="padding: 0.5rem 0; border-bottom: 1px solid #4a4a5e;">
                        <div style="font-weight: 500;">Payment received</div>
                        <div style="font-size: 0.875rem; color: var(--admin-text-secondary);">$1,200 - Unit B205</div>
                        <div style="font-size: 0.75rem; color: var(--admin-text-secondary);">4 hours ago</div>
                    </div>
                    <div style="padding: 0.5rem 0; border-bottom: 1px solid #4a4a5e;">
                        <div style="font-weight: 500;">Maintenance request</div>
                        <div style="font-size: 0.875rem; color: var(--admin-text-secondary);">Plumbing issue - Unit C301</div>
                        <div style="font-size: 0.75rem; color: var(--admin-text-secondary);">6 hours ago</div>
                    </div>
                    <div style="padding: 0.5rem 0;">
                        <div style="font-weight: 500;">Bill generated</div>
                        <div style="font-size: 0.875rem; color: var(--admin-text-secondary);">Monthly rent - All units</div>
                        <div style="font-size: 0.75rem; color: var(--admin-text-secondary);">1 day ago</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Announcements Preview -->
        <div class="card">
            <div class="card-header flex-between">
                <h3 class="card-title">Recent Announcements</h3>
                <a href="announcements.html" class="btn btn-primary">Manage Announcements</a>
            </div>
            <div id="announcementsPreview">
                <div style="padding: 1rem; border: 1px solid #4a4a5e; border-radius: 0.5rem; margin-bottom: 1rem;">
                    <div style="font-weight: 600; margin-bottom: 0.5rem;">Building Maintenance Schedule</div>
                    <div style="color: var(--admin-text-secondary); margin-bottom: 0.5rem;">
                        The building elevator will be under maintenance on Saturday, December 16th from 9 AM to 3 PM. Please use the stairs during this time.
                    </div>
                    <div style="font-size: 0.75rem; color: var(--admin-text-secondary);">
                        Published 2 days ago â€¢ <span class="badge badge-success">Active</span>
                    </div>
                </div>
                <div style="padding: 1rem; border: 1px solid #4a4a5e; border-radius: 0.5rem;">
                    <div style="font-weight: 600; margin-bottom: 0.5rem;">Holiday Office Hours</div>
                    <div style="color: var(--admin-text-secondary); margin-bottom: 0.5rem;">
                        Our office will have modified hours during the holiday season. Please check the updated schedule on our website.
                    </div>
                    <div style="font-size: 0.75rem; color: var(--admin-text-secondary);">
                        Published 1 week ago â€¢ <span class="badge badge-success">Active</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Quick Actions</h3>
            </div>
            <div class="grid grid-4">
                <a href="units.html" class="btn btn-primary">Add New Unit</a>
                <a href="tenants.html" class="btn btn-secondary">Add Tenant</a>
                <a href="bills.html" class="btn btn-primary">Generate Bills</a>
                <a href="sms_email.html" class="btn btn-secondary">Send Message</a>
            </div>
        </div>
    </div>

    <!-- Chatbot -->
    <button class="chatbot-button" onclick="openChatbot()">ðŸ’¬</button>
    <div id="chatbotWindow" class="chatbot-window hidden">
        <div class="chatbot-header">
            <span>APTI Assistant</span>
            <button onclick="closeChatbot()" style="float: right; background: none; border: none; color: inherit; cursor: pointer;">Ã—</button>
        </div>
        <div class="chatbot-messages" id="chatbotMessages">
            <div style="padding: 0.5rem; background: rgba(79, 70, 229, 0.1); border-radius: 0.5rem; margin-bottom: 0.5rem;">
                This is the tenant message receiver. Messages from tenants will appear here.
            </div>
        </div>
        <div class="chatbot-input" style="display: none;">
            <input type="text" id="chatbotInput" placeholder="Type your message..." class="form-input" disabled>
            <button onclick="sendChatMessage()" class="btn btn-primary" disabled>Send</button>
        </div>
    </div>

    <script src="../common/js/util.js"></script>
    <script src="../common/js/auth.js"></script>
    <script src="../common/js/admin.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication on page load
            if (!APTI_Auth.checkAuthentication('admin')) {
                return;
            }

            // Load user info
            const currentUser = APTI_Auth.getCurrentUser('admin');
            if (currentUser) {
                document.querySelector('.welcome-text').textContent = `Welcome ${currentUser.name}`;
            }

            // Load dashboard statistics
            loadDashboardStats();
        });

        function loadDashboardStats() {
            try {
                // Mock data for demonstration
                const stats = {
                    totalUnits: 48,
                    totalTenants: 42,
                    unpaidBills: 7,
                    maintenanceRequests: 3
                };

                document.getElementById('totalUnits').textContent = stats.totalUnits;
                document.getElementById('totalTenants').textContent = stats.totalTenants;
                document.getElementById('unpaidBills').textContent = stats.unpaidBills;
                document.getElementById('maintenanceRequests').textContent = stats.maintenanceRequests;

                // Load communication statistics
                loadCommunicationStats();

            } catch (error) {
                console.error('Error loading dashboard stats:', error);
            }
        }

        async function loadCommunicationStats() {
            try {
                // Load communication data from storage
                const communicationData = APTI_Utils.storage.get('apti_communication_data') || {
                    messages: [],
                    analytics: {
                        total: 0,
                        sms: 0,
                        email: 0,
                        success: 0
                    }
                };

                const total = communicationData.analytics.total;
                const success = communicationData.analytics.success;
                const successRate = total > 0 ? Math.round((success / total) * 100) : 0;

                document.getElementById('totalMessages').textContent = total;
                document.getElementById('messageSuccessRate').textContent = successRate + '%';

            } catch (error) {
                console.error('Error loading communication stats:', error);
                document.getElementById('totalMessages').textContent = '0';
                document.getElementById('messageSuccessRate').textContent = '0%';
            }
        }

        function closeChatbot() {
            const chatbotWindow = document.getElementById('chatbotWindow');
            chatbotWindow.style.display = 'none';
            chatbotWindow.classList.add('hidden');
        }

        function openChatbot() {
            const chatbotWindow = document.getElementById('chatbotWindow');
            chatbotWindow.style.display = 'block';
            chatbotWindow.classList.remove('hidden');
        }

    </script>
</body>
</html>